<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dashboard com métricas</title>

    <!-- Importa Chart.js para gráficos -->
    <script src = "https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
    .container {
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
        gap: 20px;
        margin-top: 20px;
    }

    .grafico {
        width: 45%;
        max-width: 600px;
    }

    canvas {
        width: 100% !important;
        height: 300px !important;
    }
    </style>
</head>
<body>

    <div class="container">
        <!-- Gráfico de CPU -->
        <div class="grafico">
            <h2>Uso de CPU (%)</h2>
            <canvas id="cpuChart"></canvas>
        </div>

        <!-- Gráfico de Memória -->
        <div class="grafico">
            <h2>Memória (RSS em Mb)</h2>
            <canvas id="memChart"></canvas>
        </div>

        <!-- Gráfico de I/O -->
        <div class="grafico">
            <h2>I/O de Disco (Mb/s)</h2>
            <canvas id="ioChart"></canvas>
        </div>

        <!-- Gráfico de Rede -->
        <div class="grafico">
            <h2>Rede (Mb/s)</h2>
            <canvas id="netChart"></canvas>
        </div>
    </div>

    <script>
        // Função para carregar dados da API
        async function carregarDados() {
            const resp = await fetch("/api/dados");
            const dados = await resp.json();

            if (dados.length == 0) return;

            // Prepara dados para os gráficos
            const labels = dados.map((_, index) => index + 1);
            const cpu = dados.map(l => l.cpu_percent);
            const rss = dados.map(l => l.rss_mb / (1024 * 1024));
            const ioRead = dados.map(l => l.io_read_rate_mbs ?? 0);
            const ioWrite = dados.map(l => l.io_write_rate_mbs ?? 0);
            const netRx = dados.map(l => l.net_rx_rate_mbs ?? 0);
            const netTx = dados.map(l => l.net_tx_rate_mbs ?? 0);

            // Atualiza gráficos com novos dados
            cpuChart.data.labels = labels;
            cpuChart.data.datasets[0].data = cpu;
            cpuChart.update();

            memChart.data.labels = labels;
            memChart.data.datasets[0].data = rss;
            memChart.update();

            ioChart.data.labels = labels;
            ioChart.data.datasets[0].data = ioRead;
            ioChart.data.datasets[1].data = ioWrite;
            ioChart.update();

            netChart.data.labels = labels;
            netChart.data.datasets[0].data = netRx;
            netChart.data.datasets[1].data = netTx;
            netChart.update();
        }

        // Configuração do gráfico de CPU
        const cpuChart = new Chart(document.getElementById("cpuChart"), {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "CPU (%)",
                    data: [],
                    borderColor: "red"
                }]
            },
            options: {
                maintainAspectRatio: false
            }
        });

        // Configuração do gráfico de Memória
        const memChart = new Chart(document.getElementById("memChart"), {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "RSS (Mb)",
                    data: [],
                    borderColor: "red"
                }]
            },
            options: {
                maintainAspectRatio: false
            }
        });

        // Configuração do gráfico de I/O (Leitura e Escrita)
        const ioChart = new Chart(document.getElementById("ioChart"), {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "Leitura (Mb/s)",
                    data: [],
                    borderColor: "green"
                },
                {
                    label: "Escrita (Mb/s)",
                    data: [],
                    borderColor: "orange"
                }]
            },
            options: {
                maintainAspectRatio: false
            }
        });

        // Configuração do gráfico de Rede (Download e Upload)
        const netChart = new Chart(document.getElementById("netChart"), {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "Recebido (Mb/s)",
                    data: [],
                    borderColor: "purple"
                },
                {
                    label: "Enviado (Mb/s)",
                    data: [],
                    borderColor: "brown"
                }]
            },
            options: {
                maintainAspectRatio: false
            }
        });

        // Atualiza dados a cada 5 segundos
        setInterval(carregarDados, 5000);
        carregarDados(); // Carrega dados inicialmente
    </script>
</body>
</html>